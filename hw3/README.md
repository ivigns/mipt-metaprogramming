# Функтор и паттерн "Посетитель"

## Функтор

Шаблонный класс `Functor` в качестве шаблонных аргументов принимает возвращаемый тип и типы аргументов, в конструкторе передается исполняемая функция. Использование `operator()` для функтора выполняет вызов функции. Функтор можно копировать.

## Паттерн "Посетитель"

В репозитории представлен пример паттерна посетитель. В качестве visitor-a используется класс `Writer`, который умеет выводить структуры в текстовом формате, а в качестве acceptor-a используется класс `Shape` фигуры.

Конкретные реализации `Writer`:

 - `XMLWriter` - выводит в xml формате. В конструкторе принимает версию XML и список пользователей этого формата (допустим, что в некоторой компании все переходят на json, и чтобы очередной раз напомнить юзерам не использовать xml, выводят тех немногих, кто им пользуется).
 - `JsonWriter` - выводит в json формате. Имеет внутрений таймер для подсчета времени для рендера.

 Конкретные реализации `Shape`:

 - `Circle` - можно задать радиус и отражение относительно начала координат.
 - `Square` - можно задать длину стороны и опорную точку (центр квадрата, левый верхний или правый нижний угол). В текстовом выводе будут указаны координат левого верхнего угла.

Функции `Accept` и `Visit` позволяют получить текстовый шаблон, в котором указано все, кроме координат фигуры. Координаты фигуры не хранятся в классе фигуры, а задаются отдельно.

Вместо простого `acceptor->Accept(visitor)` используется `VisitDispatcher`, позволяющий сразу подставить в текстовый шаблон координаты и напечатать красивый вывод. В шаблонных аргументах передается базовый класс visitor, typelist с его наследниками, базовый класс acceptor, typelist с его наследниками, возвращаемый тип метода `Accept` (в нашем случае `std::string`), возвращаемый тип функтора (в нашем случае `void`), дополнительные аргументы (в нашем случае `double x, double y`). Функтор, о котором идет речь, это шаблонный класс `VisitFunctor`. Он наследуется от `IFunctor` так же, как и `Functor`, но работает по-другому. Ему не нужно передавать функцию в конструкторе и по умолчанию считается, что он не определен ни для какого списка аргументов и будет выводиться сообщение об ошибке при его использовании. Чтобы им пользоваться, нужно определить шаблонную спецификацию для нужного списка аргуметов. В нашем случае определено 4 спецификации для всех типов выода и фигур с доп аргументами - координатами фигуры.

Использовать диспатчер можно с помощью статической функции `Go`, в которую передается указатель на базового visitor-a, базового acceptor-a и доп. аргументы. Стоит заметить, что используемый внутри `VisitFunctor` может извлекать данные не просто из интерфейса visitor-a или acceptor-a, а из конкретных реализаций, например, список юзеров `XMLWriter`.
